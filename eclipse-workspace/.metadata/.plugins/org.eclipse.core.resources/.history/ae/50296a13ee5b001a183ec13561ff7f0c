/* stdio.cpp */
#include "stdio.h"
#include <stdarg.h>
#include <string.h>
#include "Enclave_t.h"
#include "sgx_tseal.h"
#include "sgx_tprotected_fs.h"


int stdin = 0, stdout = 1, stderr = 2;

void fprintf(int file, const char* fmt, ...) {
#define BUF_SIZE 1024
    char buf[BUFSIZ] = {'\0'};
    va_list ap;
    va_start(ap, fmt);
    vsnprintf(buf, BUFSIZ, fmt, ap);
    va_end(ap);
    size_t len = strlen(buf);
    write(file, buf, len);
}

int open(const char* filename, int mode) {
	const char* modeAsChar = mode;
	SGX_FILE* a;
	a = sgx_fopen_auto_key(filename, modeAsChar);
	return a;
}

int read(int file, void *buf, unsigned int size) {
    int ret;
    if (ocall_read(&ret, file, buf, size) != SGX_SUCCESS) return -1;
    return ret;
}

int write(int file, void *buf, unsigned int size) {
    int ret;
    if (ocall_write(&ret, file, buf, size) != SGX_SUCCESS) return -1;
    return ret;
}

void close(SGX_FILE* fp) {
	sgx_fclose(fp);
}
